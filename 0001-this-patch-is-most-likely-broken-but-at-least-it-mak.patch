From 8a4d16ff39b6c4109aef5cdc6517301653813c97 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Per=20=C3=98yvind=20Karlsen=20=28proyvind=29?=
 <peroyvind@mandriva.org>
Date: Sun, 30 Nov 2014 11:16:07 +0100
Subject: [PATCH] this patch is most likely broken, but at least it makes stuff
 build for now...

---
 mythplugins/mythgallery/dcrawplugin/dcrawplugin.cpp  | 4 +---
 mythplugins/mythgallery/dcrawplugin/dcrawplugin.h    | 1 +
 mythplugins/mythgallery/dcrawplugin/dcrawplugin.json | 5 +++++
 mythplugins/mythgallery/dcrawplugin/dcrawplugin.pro  | 3 ++-
 4 files changed, 9 insertions(+), 4 deletions(-)
 create mode 100644 mythplugins/mythgallery/dcrawplugin/dcrawplugin.json

diff --git a/mythplugins/mythgallery/dcrawplugin/dcrawplugin.cpp b/mythplugins/mythgallery/dcrawplugin/dcrawplugin.cpp
index 2cf059b..f10052a 100644
--- a/mythplugins/mythgallery/dcrawplugin/dcrawplugin.cpp
+++ b/mythplugins/mythgallery/dcrawplugin/dcrawplugin.cpp
@@ -3,6 +3,7 @@
 #include "dcrawformats.h"
 #include "dcrawhandler.h"
 
+#include <QtPlugin>
 #include <QByteArray>
 #include <QImageIOHandler>
 #include <QImageIOPlugin>
@@ -40,6 +41,3 @@ QImageIOHandler *DcrawPlugin::create(QIODevice *device, const QByteArray &format
 
 // This shouldn't be necessary, but it shuts up the dang compiler warning.
 QObject* qt_plugin_instance_dcrawplugin();
-
-Q_EXPORT_PLUGIN2(dcrawplugin, DcrawPlugin)
-
diff --git a/mythplugins/mythgallery/dcrawplugin/dcrawplugin.h b/mythplugins/mythgallery/dcrawplugin/dcrawplugin.h
index f9aee3c..4b08cea 100644
--- a/mythplugins/mythgallery/dcrawplugin/dcrawplugin.h
+++ b/mythplugins/mythgallery/dcrawplugin/dcrawplugin.h
@@ -9,6 +9,7 @@ class DcrawPlugin : public QImageIOPlugin
 {
 
     Q_OBJECT
+    Q_PLUGIN_METADATA(IID "DcrawPlugin"  FILE "dcrawplugin.json")
 
 public:
 
diff --git a/mythplugins/mythgallery/dcrawplugin/dcrawplugin.json b/mythplugins/mythgallery/dcrawplugin/dcrawplugin.json
new file mode 100644
index 0000000..b5c5170
--- /dev/null
+++ b/mythplugins/mythgallery/dcrawplugin/dcrawplugin.json
@@ -0,0 +1,5 @@
+{ "Keys": [ "arw","ARW","bay","BAY","bmq","BMQ", "cr2","CR2","crw","CRW",
+	 "cs1","CS1","dc2","DC2","dcr","DCR","dng","DNG","fff","FFF",
+	 "k25","K25","kdc","KDC","mos","MOS","mrw","MRW","nef","NEF",
+	 "orf","ORF","pef","PEF","raf","RAF","raw","RAW","rdc","RDC",
+	 "srf","SRF","x3f","X3F" ] }
diff --git a/mythplugins/mythgallery/dcrawplugin/dcrawplugin.pro b/mythplugins/mythgallery/dcrawplugin/dcrawplugin.pro
index b74a2fb..342503d 100644
--- a/mythplugins/mythgallery/dcrawplugin/dcrawplugin.pro
+++ b/mythplugins/mythgallery/dcrawplugin/dcrawplugin.pro
@@ -14,5 +14,6 @@ HEADERS += dcrawplugin.h
 SOURCES += dcrawformats.cpp
 SOURCES += dcrawhandler.cpp
 SOURCES += dcrawplugin.cpp
+OTHERFILES += dcrawplugin.json
 
-QT += sql
+QT += sql widgets
-- 
1.9.0

